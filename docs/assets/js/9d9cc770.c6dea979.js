"use strict";(self.webpackChunkmcp_workshop=self.webpackChunkmcp_workshop||[]).push([[2887],{426:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"mcp-concepts/consuming-server/activity-llm-client","title":"Activity: Create an MCP client using LLM","description":"Let\'s add an LLM and ensure the LLM is what\'s between the user and the server. Here\'s how it will work on high level:","source":"@site/docs/mcp-concepts/01-consuming-server/06-activity-llm-client.md","sourceDirName":"mcp-concepts/01-consuming-server","slug":"/mcp-concepts/consuming-server/activity-llm-client","permalink":"/mcp-workshop/docs/mcp-concepts/consuming-server/activity-llm-client","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/mcp-concepts/01-consuming-server/06-activity-llm-client.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"LLM Client","permalink":"/mcp-workshop/docs/mcp-concepts/consuming-server/llm-client"},"next":{"title":"SSE Servers","permalink":"/mcp-workshop/docs/category/sse-servers"}}');var o=t(4848),s=t(8453);const l={sidebar_position:6},i="Activity: Create an MCP client using LLM",c={},a=[{value:"-1- Create a client file",id:"-1--create-a-client-file",level:2},{value:"-2- Run the client",id:"-2--run-the-client",level:2}];function h(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"activity-create-an-mcp-client-using-llm",children:"Activity: Create an MCP client using LLM"})}),"\n",(0,o.jsx)(n.p,{children:"Let's add an LLM and ensure the LLM is what's between the user and the server. Here's how it will work on high level:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"The client will call the server and get information about its tools. Based on this response, the client will remember the tools and their parameters."}),"\n",(0,o.jsx)(n.li,{children:"The user then asks the client a question which in turn will call the LLM to get a response. If the LLM deems it necessary, it will call the server's tools to get more information."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Next, let's implement this in code."}),"\n",(0,o.jsx)(n.h2,{id:"-1--create-a-client-file",children:"-1- Create a client file"}),"\n",(0,o.jsxs)(n.p,{children:["Use your existing Node.js project but add a ",(0,o.jsx)(n.code,{children:"Client.ts"})," file."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the following code to ",(0,o.jsx)(n.code,{children:"Client.ts"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { Client } from "@modelcontextprotocol/sdk/client/index.js";\r\nimport { StdioClientTransport } from "@modelcontextprotocol/sdk/client/stdio.js";\r\nimport { Transport } from "@modelcontextprotocol/sdk/shared/transport.js";\r\nimport OpenAI from "openai";\r\nimport { z } from "zod"; // Import zod for schema validation\n'})}),"\n",(0,o.jsx)(n.p,{children:"Now you have all the imports you need including OpenAI and you've instantiated an openai client. Next, let's add code to create the client and connect to the server."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add the following code to create a client class:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'class MCPClient {\r\n    private openai: OpenAI;\r\n    private client: Client;\r\n    constructor(){\r\n        this.openai = new OpenAI({\r\n            baseURL: "https://models.inference.ai.azure.com", \r\n            apiKey: process.env.GITHUB_TOKEN,\r\n        });\r\n\r\n        this.client = new Client(\r\n            {\r\n                name: "example-client",\r\n                version: "1.0.0"\r\n            },\r\n            {\r\n                capabilities: {\r\n                prompts: {},\r\n                resources: {},\r\n                tools: {}\r\n                }\r\n            }\r\n            );    \r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"In the preceding code:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"MCPClient"})," is defined as a class that will handle the connection to the server and the LLM."]}),"\n",(0,o.jsx)(n.li,{children:"A constructor is defined that initializes the OpenAI client and the MCP client. The OpenAI client is initialized with the base URL and API key. The MCP client is initialized with the name and version."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Great, we now have a client that can connect to the server. Next, let's add more code to wire up the LLM and the server."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add the following so we can connect to the server:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'async connectToServer(transport: Transport) {\r\n     await this.client.connect(transport);\r\n     this.run();\r\n     console.error("MCPClient started on stdin/stdout");\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"It doesn't do much other than connect to the server and run the client."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Let's add the following code to help us convert an MCP tool response into a tool an LLM can understand:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'openAiToolAdapter(tool: {\r\n     name: string;\r\n     description?: string;\r\n     input_schema: any;\r\n       }) {\r\n       // Create a zod schema based on the input_schema\r\n       const schema = z.object(tool.input_schema);\r\n   \r\n       return {\r\n         type: "function" as const, // Explicitly set type to "function"\r\n         function: {\r\n           name: tool.name,\r\n           description: tool.description,\r\n           parameters: {\r\n           type: "object",\r\n           properties: tool.input_schema.properties,\r\n           required: tool.input_schema.required,\r\n           },\r\n         },\r\n       };\r\n }\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Next, let's add a function that lets us process a response from an LLM and make a tool call if the LLM indicates a tool should be called:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'async callTools(\r\n    tool_calls: OpenAI.Chat.Completions.ChatCompletionMessageToolCall[],\r\n    toolResults: any[]\r\n  ) {\r\n    for (const tool_call of tool_calls) {\r\n      const toolName = tool_call.function.name;\r\n      const args = tool_call.function.arguments;\r\n\r\n      console.log(`Calling tool ${toolName} with args ${JSON.stringify(args)}`);\r\n\r\n\r\n      // 2. Call the server\'s tool \r\n      const toolResult = await this.client.callTool({\r\n        name: toolName,\r\n        arguments: JSON.parse(args),\r\n      });\r\n\r\n      console.log("Tool result: ", toolResult);\r\n\r\n      // 3. Do something with the result\r\n      // TODO  \r\n\r\n     }\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"In the preceding code:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"callTools"})," function takes an array of tool calls and their results. It iterates over the tool calls, calling each tool on the server and logging the result."]}),"\n",(0,o.jsxs)(n.li,{children:["See the part where we call ",(0,o.jsx)(n.code,{children:"callTool"})," with a tool name and arguments. This is how we call a tool on the server. The result is then logged to the console."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Finally, we add the function that sets everything up called ",(0,o.jsx)(n.code,{children:"run"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'async run() {\r\n    console.log("Asking server for available tools");\r\n    const toolsResult = await this.client.listTools();\r\n    const tools = toolsResult.tools.map((tool) => {\r\n        return this.openAiToolAdapter({\r\n          name: tool.name,\r\n          description: tool.description,\r\n          input_schema: tool.inputSchema,\r\n        });\r\n    });\r\n\r\n    const messages: OpenAI.Chat.Completions.ChatCompletionMessageParam[] = [\r\n        {\r\n            role: "user",\r\n            content: "What is the sum of 2 and 3?",\r\n        },\r\n    ];\r\n\r\n    console.log("Querying LLM: ", messages[0].content);\r\n    let response = this.openai.chat.completions.create({\r\n        model: "gpt-4o-mini",\r\n        max_tokens: 1000,\r\n        messages,\r\n        tools: tools,\r\n    });    \r\n\r\n    let results: any[] = [];\r\n\r\n    // 1. Go through the LLM response,for each choice, check if it has tool calls \r\n    (await response).choices.map(async (choice: { message: any; }) => {\r\n      const message = choice.message;\r\n      if (message.tool_calls) {\r\n          console.log("Making tool call")\r\n          await this.callTools(message.tool_calls, results);\r\n      }\r\n    });\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"In the preceding code:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"run"})," function first queries the server for available tools and converts them into a format that the LLM can understand."]}),"\n",(0,o.jsx)(n.li,{children:"It then sends a message to the LLM asking for the sum of 2 and 3."}),"\n",(0,o.jsxs)(n.li,{children:["If the LLM indicates that a tool should be called, it calls the ",(0,o.jsx)(n.code,{children:"callTools"})," function to handle the tool call."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Here's the full code for reference:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { Client } from "@modelcontextprotocol/sdk/client/index.js";\r\nimport { StdioClientTransport } from "@modelcontextprotocol/sdk/client/stdio.js";\r\nimport { Transport } from "@modelcontextprotocol/sdk/shared/transport.js";\r\nimport OpenAI from "openai";\r\nimport { z } from "zod"; // Import zod for schema validation\r\n\r\nclass MyClient {\r\n    private openai: OpenAI;\r\n    private client: Client;\r\n    constructor(){\r\n        this.openai = new OpenAI({\r\n            baseURL: "https://models.inference.ai.azure.com", // might need to change to this url in the future: https://models.github.ai/inference\r\n            apiKey: process.env.GITHUB_TOKEN,\r\n        });\r\n\r\n       \r\n        \r\n        this.client = new Client(\r\n            {\r\n                name: "example-client",\r\n                version: "1.0.0"\r\n            },\r\n            {\r\n                capabilities: {\r\n                prompts: {},\r\n                resources: {},\r\n                tools: {}\r\n                }\r\n            }\r\n            );    \r\n    }\r\n\r\n    async connectToServer(transport: Transport) {\r\n        await this.client.connect(transport);\r\n        this.run();\r\n        console.error("MCPClient started on stdin/stdout");\r\n    }\r\n\r\n    openAiToolAdapter(tool: {\r\n        name: string;\r\n        description?: string;\r\n        input_schema: any;\r\n          }) {\r\n          // Create a zod schema based on the input_schema\r\n          const schema = z.object(tool.input_schema);\r\n      \r\n          return {\r\n            type: "function" as const, // Explicitly set type to "function"\r\n            function: {\r\n              name: tool.name,\r\n              description: tool.description,\r\n              parameters: {\r\n              type: "object",\r\n              properties: tool.input_schema.properties,\r\n              required: tool.input_schema.required,\r\n              },\r\n            },\r\n          };\r\n    }\r\n    \r\n    async callTools(\r\n        tool_calls: OpenAI.Chat.Completions.ChatCompletionMessageToolCall[],\r\n        toolResults: any[]\r\n      ) {\r\n        for (const tool_call of tool_calls) {\r\n          const toolName = tool_call.function.name;\r\n          const args = tool_call.function.arguments;\r\n    \r\n          console.log(`Calling tool ${toolName} with args ${JSON.stringify(args)}`);\r\n    \r\n    \r\n          // 2. Call the server\'s tool \r\n          const toolResult = await this.client.callTool({\r\n            name: toolName,\r\n            arguments: JSON.parse(args),\r\n          });\r\n    \r\n          console.log("Tool result: ", toolResult);\r\n    \r\n          // 3. Do something with the result\r\n          // TODO  \r\n    \r\n         }\r\n    }\r\n\r\n    async run() {\r\n        console.log("Asking server for available tools");\r\n        const toolsResult = await this.client.listTools();\r\n        const tools = toolsResult.tools.map((tool) => {\r\n            return this.openAiToolAdapter({\r\n              name: tool.name,\r\n              description: tool.description,\r\n              input_schema: tool.inputSchema,\r\n            });\r\n        });\r\n    \r\n        const messages: OpenAI.Chat.Completions.ChatCompletionMessageParam[] = [\r\n            {\r\n                role: "user",\r\n                content: "What is the sum of 2 and 3?",\r\n            },\r\n        ];\r\n\r\n        console.log("Querying LLM: ", messages[0].content);\r\n        let response = this.openai.chat.completions.create({\r\n            model: "gpt-4o-mini",\r\n            max_tokens: 1000,\r\n            messages,\r\n            tools: tools,\r\n        });    \r\n\r\n        let results: any[] = [];\r\n    \r\n        // 1. Go through the LLM response,for each choice, check if it has tool calls \r\n        (await response).choices.map(async (choice: { message: any; }) => {\r\n          const message = choice.message;\r\n          if (message.tool_calls) {\r\n              console.log("Making tool call")\r\n              await this.callTools(message.tool_calls, results);\r\n          }\r\n        });\r\n    }\r\n    \r\n}\r\n\r\nlet client = new MyClient();\r\n const transport = new StdioClientTransport({\r\n            command: "node",\r\n            args: ["./build/index.js"]\r\n        });\r\n\r\nclient.connectToServer(transport);\n'})}),"\n",(0,o.jsx)(n.p,{children:"That's it, now you have a working client."}),"\n",(0,o.jsx)(n.h2,{id:"-2--run-the-client",children:"-2- Run the client"}),"\n",(0,o.jsxs)(n.p,{children:["To test this client out, you're recommended to add a task to your ",(0,o.jsx)(n.em,{children:"package.json"}),' called "client" that runs the client. This way you can run the client with ',(0,o.jsx)(n.code,{children:"npm run client"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "scripts": {\r\n    "client": "tsx node build/client.js"\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Here's a repository you can clone if you want to test this out:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/softchris/tutorial-mcp.git\r\ncd tutorial-mcp\r\nnpm run client\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see the following output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"Asking server for available tools\r\nQuerying LLM:  What is the sum of 2 and 3?\r\nMaking tool call\r\nTool result:  { content: [ { type: 'text', text: '5' } ] }\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>i});var r=t(6540);const o={},s=r.createContext(o);function l(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);